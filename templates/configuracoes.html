{% extends "base.html" %}

{% block title %}Configurações - Neurotech{% endblock %}

{% block page_title %}Configurações do Sistema{% endblock %}

{% block page_subtitle %}Visualize e gerencie as configurações de integração com o Jira{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <!-- Status Geral das Configurações -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-cog"></i> Status das Configurações
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <div class="config-status-item">
                            <div class="status-icon {% if status.url_valida %}status-success{% else %}status-error{% endif %}">
                                <i class="fas fa-link"></i>
                            </div>
                            <div class="status-info">
                                <h6>URL do Jira</h6>
                                <span class="status-text {% if status.url_valida %}text-success{% else %}text-danger{% endif %}">
                                    {% if status.url_valida %}Configurado{% else %}Não configurado{% endif %}
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="config-status-item">
                            <div class="status-icon {% if status.email_valido %}status-success{% else %}status-error{% endif %}">
                                <i class="fas fa-envelope"></i>
                            </div>
                            <div class="status-info">
                                <h6>Email</h6>
                                <span class="status-text {% if status.email_valido %}text-success{% else %}text-danger{% endif %}">
                                    {% if status.email_valido %}Configurado{% else %}Não configurado{% endif %}
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="config-status-item">
                            <div class="status-icon {% if status.token_valido %}status-success{% else %}status-error{% endif %}">
                                <i class="fas fa-key"></i>
                            </div>
                            <div class="status-info">
                                <h6>API Token</h6>
                                <span class="status-text {% if status.token_valido %}text-success{% else %}text-danger{% endif %}">
                                    {% if status.token_valido %}Configurado{% else %}Não configurado{% endif %}
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="config-status-item">
                            <div class="status-icon {% if status.auth_valida %}status-success{% else %}status-error{% endif %}">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="status-info">
                                <h6>Autenticação</h6>
                                <span class="status-text {% if status.auth_valida %}text-success{% else %}text-danger{% endif %}">
                                    {% if status.auth_valida %}Configurado{% else %}Não configurado{% endif %}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detalhes das Configurações -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-info-circle"></i> Detalhes das Configurações
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="config-detail-item">
                            <label class="config-label">
                                <i class="fas fa-link"></i> JIRA_BASE_URL
                            </label>
                            <div class="config-value">
                                <code>{{ configuracoes.JIRA_BASE_URL }}</code>
                                <button class="btn btn-sm btn-outline-secondary ms-2" onclick="copyToClipboard('{{ configuracoes.JIRA_BASE_URL }}')">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="config-detail-item">
                            <label class="config-label">
                                <i class="fas fa-envelope"></i> JIRA_EMAIL
                            </label>
                            <div class="config-value">
                                <code>{{ configuracoes.JIRA_EMAIL }}</code>
                                <button class="btn btn-sm btn-outline-secondary ms-2" onclick="copyToClipboard('{{ configuracoes.JIRA_EMAIL }}')">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-6">
                        <div class="config-detail-item">
                            <label class="config-label">
                                <i class="fas fa-key"></i> JIRA_API_TOKEN
                            </label>
                            <div class="config-value">
                                <code>{{ configuracoes.JIRA_API_TOKEN }}</code>
                                <button class="btn btn-sm btn-outline-secondary ms-2" onclick="copyToClipboard('{{ configuracoes.JIRA_API_TOKEN }}')">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                            <small class="text-muted">Token mascarado por segurança</small>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="config-detail-item">
                            <label class="config-label">
                                <i class="fas fa-shield-alt"></i> JIRA_AUTH
                            </label>
                            <div class="config-value">
                                <code>{{ configuracoes.JIRA_AUTH }}</code>
                                <button class="btn btn-sm btn-outline-secondary ms-2" onclick="copyToClipboard('{{ configuracoes.JIRA_AUTH }}')">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Informações Adicionais -->
        <div class="card mt-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-question-circle"></i> Informações Importantes
                </h5>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <h6><i class="fas fa-info-circle"></i> Sobre as Configurações</h6>
                    <ul class="mb-0">
                        <li>As configurações são carregadas do arquivo <code>.env</code> na raiz do projeto</li>
                        <li>O token da API é mascarado por questões de segurança</li>
                        <li>Para modificar as configurações, edite o arquivo <code>.env</code> e reinicie o servidor</li>
                        <li>Certifique-se de que o arquivo <code>.env</code> não seja commitado no repositório</li>
                    </ul>
                </div>
                
                <div class="alert alert-warning">
                    <h6><i class="fas fa-exclamation-triangle"></i> Segurança</h6>
                    <ul class="mb-0">
                        <li>Nunca compartilhe seu token de API</li>
                        <li>Use sempre HTTPS para conexões com o Jira</li>
                        <li>Mantenha o arquivo <code>.env</code> seguro e com permissões restritas</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(function() {
        // Mostrar feedback visual
        const button = event.target.closest('button');
        const originalIcon = button.innerHTML;
        button.innerHTML = '<i class="fas fa-check"></i>';
        button.classList.remove('btn-outline-secondary');
        button.classList.add('btn-success');
        
        setTimeout(() => {
            button.innerHTML = originalIcon;
            button.classList.remove('btn-success');
            button.classList.add('btn-outline-secondary');
        }, 2000);
    }).catch(function(err) {
        console.error('Erro ao copiar: ', err);
        alert('Erro ao copiar para a área de transferência');
    });
}
</script>

<style>
.config-status-item {
    display: flex;
    align-items: center;
    padding: 1rem;
    border-radius: 8px;
    background-color: #f8f9fa;
    margin-bottom: 1rem;
}

.status-icon {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 1rem;
    font-size: 1.2rem;
}

.status-success {
    background-color: #d4edda;
    color: #155724;
}

.status-error {
    background-color: #f8d7da;
    color: #721c24;
}

.status-info h6 {
    margin: 0;
    font-weight: 600;
    color: #495057;
}

.status-text {
    font-size: 0.9rem;
    font-weight: 500;
}

.config-detail-item {
    margin-bottom: 1.5rem;
}

.config-label {
    display: block;
    font-weight: 600;
    color: #495057;
    margin-bottom: 0.5rem;
}

.config-value {
    display: flex;
    align-items: center;
}

.config-value code {
    background-color: #f8f9fa;
    padding: 0.5rem;
    border-radius: 4px;
    border: 1px solid #dee2e6;
    flex: 1;
    word-break: break-all;
}

.alert ul {
    padding-left: 1.2rem;
}

.alert li {
    margin-bottom: 0.25rem;
}
</style>
{% endblock %}
