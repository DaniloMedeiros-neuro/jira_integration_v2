{% extends "base_sb_admin.html" %}

{% block title %}Neurotech - Gerenciador de Casos de Teste{% endblock %}

{% block page_title %}Gerenciador de Casos de Teste{% endblock %}

{% block content %}
<!-- Page Heading -->
<div class="d-sm-flex align-items-center justify-content-between mb-4">
    <h1 class="h3 mb-0 text-gray-800">Buscar Casos de Teste</h1>
</div>

<!-- Search Card -->
<div class="card shadow mb-4">
    <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">
            <i class="fas fa-search fa-fw me-2"></i>Buscar Requisito
        </h6>
    </div>
    <div class="card-body">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text">
                            <i class="fas fa-clipboard-list"></i>
                        </span>
                    </div>
                    <input type="text" class="form-control" id="requisitoPai" 
                           placeholder="Digite o ID do requisito (ex: BC-126)" 
                           autocomplete="off" spellcheck="false">
                    <div class="input-group-append">
                        <button class="btn btn-primary" type="button" onclick="buscarRequisito()">
                            <i class="fas fa-search fa-sm"></i>
                            Buscar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Results Section -->
<div id="resultados" style="display: none;">
    <!-- Requisito Info Card -->
    <div id="requisitoInfoCard" class="card shadow mb-4" style="display: none;">
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary">
                <i class="fas fa-file-alt fa-fw me-2"></i>Informações do Requisito
            </h6>
        </div>
        <div class="card-body" id="requisitoInfoContent">
            <!-- Conteúdo será preenchido dinamicamente -->
        </div>
    </div>

    <!-- Cases Results Card -->
    <div class="card shadow mb-4">
        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
            <h6 class="m-0 font-weight-bold text-primary">
                <i class="fas fa-vial fa-fw me-2"></i>Casos de Teste
                <span id="totalCasos" class="badge badge-primary ml-2">0</span>
            </h6>
            <div class="d-flex align-items-center">
                <!-- View Toggle -->
                <div class="btn-group btn-group-sm mr-3" role="group">
                    <button type="button" class="btn btn-outline-primary active" id="btnListView" onclick="toggleView('list')">
                        <i class="fas fa-list"></i>
                    </button>
                    <button type="button" class="btn btn-outline-primary" id="btnCardView" onclick="toggleView('card')">
                        <i class="fas fa-th-large"></i>
                    </button>
                </div>
                <!-- Action Buttons -->
                <button id="btnNovoCaso" class="btn btn-success btn-sm mr-2" onclick="abrirEdicaoTela()" style="display: none;">
                    <i class="fas fa-plus fa-sm"></i>
                    Novo Caso
                </button>
                <button id="btnPlanilha" class="btn btn-info btn-sm" onclick="visualizarPlanilha()" style="display: none;">
                    <i class="fas fa-table fa-sm"></i>
                    Planilha
                </button>
            </div>
        </div>
        <div class="card-body">
            <!-- Loading -->
            <div id="loading" class="text-center py-4" style="display: none;">
                <div class="spinner-border text-primary" role="status">
                    <span class="sr-only">Carregando...</span>
                </div>
                <p class="mt-2 text-muted">Carregando casos de teste...</p>
            </div>
            
            <!-- Empty State -->
            <div id="emptyState" class="text-center py-5" style="display: none;">
                <i class="fas fa-inbox fa-3x text-gray-300 mb-3"></i>
                <h5 class="text-gray-500">Nenhum caso de teste encontrado</h5>
                <p class="text-muted">Não foram encontrados casos de teste para este requisito.</p>
                <button class="btn btn-primary" onclick="abrirEdicaoTela()">
                    <i class="fas fa-plus me-1"></i>
                    Criar Primeiro Caso de Teste
                </button>
            </div>
            
            <!-- Cases List View -->
            <div id="listaCasos" class="cases-list active">
                <!-- Cases will be populated here -->
            </div>
            
            <!-- Cases Grid View -->
            <div id="cardsCasos" class="cases-grid" style="display: none;">
                <!-- Cards will be populated here -->
            </div>
        </div>
    </div>
</div>

<!-- Edit Modal -->
<div class="modal fade" id="edicaoModal" tabindex="-1" role="dialog" aria-labelledby="edicaoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="edicaoModalLabel">
                    <i class="fas fa-plus me-2"></i>
                    Novo Caso de Teste
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="formCasoTesteTela">
                    <input type="hidden" id="issueKeyTela" name="issueKey">
                    <input type="hidden" id="issuePaiFormTela" name="issuePai">
                    
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="tituloTela" class="form-label">Título *</label>
                                <input type="text" class="form-control" id="tituloTela" name="titulo" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="tipoExecucaoTela" class="form-label">Tipo de Execução *</label>
                                <select class="form-control" id="tipoExecucaoTela" name="tipo_execucao" required>
                                    <option value="">Selecione...</option>
                                    <option value="Manual">Manual</option>
                                    <option value="Automático">Automático</option>
                                    <option value="Semi-automático">Semi-automático</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="tipoTesteTela" class="form-label">Tipo de Teste *</label>
                                <select class="form-control" id="tipoTesteTela" name="tipo_teste" required>
                                    <option value="">Selecione...</option>
                                    <option value="Funcional">Funcional</option>
                                    <option value="Não Funcional">Não Funcional</option>
                                    <option value="Regressão">Regressão</option>
                                    <option value="Smoke">Smoke</option>
                                    <option value="Sanity">Sanity</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="descricaoTela" class="form-label">Descrição</label>
                                <textarea class="form-control" id="descricaoTela" name="descricao" rows="3"></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="objetivoTela" class="form-label">Objetivo</label>
                                <textarea class="form-control" id="objetivoTela" name="objetivo" rows="2"></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="preCondicoesTela" class="form-label">Pré-condições</label>
                                <textarea class="form-control" id="preCondicoesTela" name="pre_condicoes" rows="2"></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="componentesTela" class="form-label">Componentes</label>
                                <input type="text" class="form-control" id="componentesTela" name="componentes" 
                                       placeholder="Digite os componentes separados por vírgula">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">
                    <i class="fas fa-times me-1"></i>
                    Cancelar
                </button>
                <button type="button" class="btn btn-primary" onclick="salvarCasoTesteTela()">
                    <i class="fas fa-save me-1"></i>
                    Salvar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Confirmation Modal -->
<div class="modal fade" id="modalConfirmacao" tabindex="-1" role="dialog" aria-labelledby="modalConfirmacaoLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalConfirmacaoLabel">Confirmar Exclusão</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Tem certeza que deseja excluir este caso de teste?</p>
                <p class="text-muted" id="confirmacaoTexto"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-danger" onclick="confirmarExclusao()">
                    <i class="fas fa-trash me-1"></i>
                    Excluir
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}
