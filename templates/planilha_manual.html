{% extends "base.html" %}

{% block title %}Planilha Manual - Neurotech{% endblock %}

{% block page_title %}Planilha Manual de Casos de Teste{% endblock %}

{% block page_subtitle %}Edite os dados e exporte para o Jira{% endblock %}

{% block page_actions %}
<button type="button" class="btn btn-success me-2" id="btnAddRow">
    <i class="fas fa-plus"></i> Adicionar Linha
</button>
<button type="button" class="btn btn-primary" id="btnExportJira">
    <i class="fas fa-upload"></i> Exportar para Jira
</button>
{% endblock %}

{% block content %}
<!-- Seção de Busca -->
<div class="search-section">
    <div class="search-container">
        <div class="search-box">
            <div class="search-input">
                <i class="fas fa-clipboard-list search-icon"></i>
                <input type="text" id="requisitoPai" placeholder="Digite o ID do requisito (ex: REQ-123)" autocomplete="off" spellcheck="false">
                <button class="search-btn" onclick="buscarRequisito()">
                    <i class="fas fa-search"></i>
                    Buscar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Seção de Importação em Massa -->
<div class="card mb-4">
    <div class="card-header">
        <h5 class="mb-0">
            <i class="fas fa-paste"></i> Importação em Massa
        </h5>
    </div>
    <div class="card-body">
        <div class="importacao-massa" id="importacaoMassa">
            <!-- Header da seção -->
            <div class="importacao-header">
                <div class="importacao-icon">
                    <i class="fas fa-upload"></i>
                </div>
                <div class="importacao-info">
                    <h5 class="importacao-title">Importação em Massa</h5>
                    <p class="importacao-description">
                        Cole dados de uma tabela do Excel, Google Sheets ou qualquer fonte para preencher automaticamente a planilha
                    </p>
                </div>
            </div>
            
            <!-- Área principal -->
            <div class="importacao-content">
                <div class="row g-4">
                    <!-- Área de entrada de dados -->
                    <div class="col-lg-8">
                        <div class="form-group">
                            <label for="dadosTabela" class="form-label fw-semibold">
                                <i class="fas fa-table me-2"></i>Dados da Tabela
                            </label>
                            <textarea 
                                class="form-control importacao-textarea" 
                                id="dadosTabela" 
                                rows="10" 
                                placeholder="Cole aqui os dados da sua tabela (incluindo cabeçalhos se disponível)..."
                            ></textarea>
                            <div class="form-text">
                                <i class="fas fa-info-circle me-1"></i>
                                Formato esperado: dados separados por tabulação (Tab) ou vírgula, com uma linha por caso de teste
                            </div>
                        </div>
                    </div>
                    
                    <!-- Painel de ações -->
                    <div class="col-lg-4">
                        <div class="importacao-actions">
                            <h6 class="importacao-actions-title">
                                <i class="fas fa-cogs me-2"></i>Ações
                            </h6>
                            
                            <div class="d-grid gap-3">
                                <button type="button" class="btn btn-primary btn-lg" id="btnProcessarDados">
                                    <i class="fas fa-magic me-2"></i>
                                    <span>Processar Dados</span>
                                </button>
                                
                                <button type="button" class="btn btn-success btn-lg" id="btnPreencherPlanilha">
                                    <i class="fas fa-arrow-down me-2"></i>
                                    <span>Preencher Planilha</span>
                                </button>
                                
                                <button type="button" class="btn btn-outline-secondary" id="btnLimparDados">
                                    <i class="fas fa-eraser me-2"></i>
                                    <span>Limpar Dados</span>
                                </button>
                            </div>
                            
                            <!-- Formato esperado -->
                            <div class="importacao-format">
                                <h6 class="importacao-format-title">
                                    <i class="fas fa-list me-2"></i>Formato Esperado
                                </h6>
                                <div class="importacao-format-content">
                                    <code>Título | Status | Tipo Execução | Tipo Teste | Componentes | Objetivo | Pré-condições | Descrição</code>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Preview dos dados processados -->
            <div id="previewContainer" class="importacao-preview" style="display: none;">
                <div class="importacao-preview-header">
                    <h6 class="importacao-preview-title">
                        <i class="fas fa-eye me-2"></i>Preview dos Dados Processados
                    </h6>
                    <span class="importacao-preview-count" id="previewCount">0 registros</span>
                </div>
                <div class="preview-table" id="previewTable"></div>
            </div>
        </div>
    </div>
</div>

<!-- Planilha Container -->
<div class="card">
    <div class="card-header">
        <h5 class="mb-0">
            <i class="fas fa-table"></i> Planilha de Casos de Teste
        </h5>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive" style="max-height: 70vh; overflow-y: auto;">
            <table class="table table-hover mb-0" id="planilhaTable">
                <thead class="table-light">
                    <tr>
                        <th style="width: 80px;">Ações</th>
                        <th style="width: 100px;">ID</th>
                        <th style="width: 200px;">Título</th>
                        <th style="width: 120px;">Status</th>
                        <th style="width: 140px;">Tipo de Execução</th>
                        <th style="width: 120px;">Tipo de Teste</th>
                        <th style="width: 150px;">Componentes</th>
                        <th style="width: 200px;">Objetivo</th>
                        <th style="width: 150px;">Pré-condições</th>
                        <th style="width: 200px;">Descrição</th>
                        <th style="width: 120px;">Criado em</th>
                        <th style="width: 120px;">Atualizado em</th>
                    </tr>
                </thead>
                <tbody id="planilhaBody">
                    <!-- Linhas serão adicionadas dinamicamente -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Instructions -->
<div class="card mt-4">
    <div class="card-body">
        <h5><i class="fas fa-info-circle"></i> Instruções</h5>
        <ol>
            <li><strong>Importação em Massa:</strong> Cole dados de uma tabela na seção superior para preencher automaticamente</li>
            <li><strong>Edição Manual:</strong> Preencha os dados diretamente na planilha ou adicione linhas individuais</li>
            <li><strong>Adicione linhas</strong> usando o botão "Adicionar Linha"</li>
            <li><strong>Remova linhas</strong> usando o botão "X" em cada linha</li>
            <li><strong>Exporte para Jira</strong> usando o botão "Exportar para Jira"</li>
            <li><strong>IDs e datas</strong> serão preenchidos automaticamente após a exportação</li>
        </ol>
    </div>
</div>

<!-- Modal para configuração de exportação -->
<div class="modal fade" id="exportModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-upload"></i> Exportar para Jira</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="form-group mb-3">
                    <label for="issuePai"><strong>Issue Pai (Requisito):</strong></label>
                    <div class="search-input compact theme-minimal">
                        <i class="fas fa-clipboard-list search-icon"></i>
                        <input type="text" id="issuePai" placeholder="Digite o ID do requisito (ex: REQ-123)" 
                               required autocomplete="off" spellcheck="false">
                    </div>
                    <small class="form-text text-muted">
                        <i class="fas fa-info-circle me-1"></i>
                        ID da issue pai onde os casos de teste serão criados. 
                        <a href="#" onclick="mostrarAjudaIssuePai()" class="text-decoration-none">Como encontrar?</a>
                    </small>
                </div>
                <div class="alert alert-info">
                    <strong>Total de casos:</strong> <span id="totalCasos">0</span>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="btnConfirmExport">
                    <i class="fas fa-upload"></i> Exportar
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/planilha_manual.js') }}"></script>
{% endblock %}
