{% extends "base_sb_admin.html" %}

{% block title %}Planilha Manual - Neurotech{% endblock %}

{% block page_title %}Planilha Manual de Casos de Teste{% endblock %}

{% block content %}
<!-- Seção de Busca -->
<div class="card shadow mb-4">
    <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">
            <i class="fas fa-search fa-fw me-2"></i>Buscar Requisito
        </h6>
    </div>
    <div class="card-body">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text">
                            <i class="fas fa-clipboard-list"></i>
                        </span>
                    </div>
                    <input type="text" class="form-control" id="requisitoPai" 
                           placeholder="Digite o ID do requisito (ex: REQ-123)" 
                           autocomplete="off" spellcheck="false">
                    <div class="input-group-append">
                        <button class="btn btn-primary" type="button" onclick="buscarRequisito()">
                            <i class="fas fa-search"></i>
                            Buscar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Seção de Importação em Massa -->
<div class="card shadow mb-4" id="importacaoMassaSection" style="display: none;">
    <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">
            <i class="fas fa-upload fa-fw me-2"></i>Importação em Massa
        </h6>
    </div>
    <div class="card-body">
        <div class="importacao-massa" id="importacaoMassa">
            <!-- Header da seção -->
            <div class="importacao-header">
                <div class="importacao-icon">
                    <i class="fas fa-upload"></i>
                </div>
                <div class="importacao-info">
                    <h5 class="importacao-title">Importação em Massa</h5>
                    <p class="importacao-description">
                        Cole dados de uma tabela do Excel, Google Sheets ou qualquer fonte para preencher automaticamente a planilha
                    </p>
                </div>
            </div>
            
            <!-- Área principal -->
            <div class="importacao-content">
                <div class="row">
                    <!-- Área de entrada de dados -->
                    <div class="col-lg-8">
                        <div class="form-group">
                            <label for="dadosTabela" class="font-weight-bold">
                                <i class="fas fa-table me-2"></i>Dados da Tabela
                            </label>
                            <textarea 
                                class="form-control importacao-textarea" 
                                id="dadosTabela" 
                                rows="10" 
                                placeholder="Cole aqui os dados da sua tabela (incluindo cabeçalhos se disponível)..."
                            ></textarea>
                            <small class="form-text text-muted">
                                <i class="fas fa-info-circle me-1"></i>
                                Formato esperado: dados separados por tabulação (Tab) ou vírgula, com uma linha por caso de teste
                            </small>
                        </div>
                    </div>
                    
                    <!-- Painel de ações -->
                    <div class="col-lg-4">
                        <div class="importacao-actions">
                            <h6 class="importacao-actions-title">
                                <i class="fas fa-cogs me-2"></i>Ações
                            </h6>
                            
                            <div class="d-grid gap-3">
                                <button type="button" class="btn btn-primary btn-lg" id="btnProcessarDados">
                                    <i class="fas fa-magic me-2"></i>
                                    <span>Processar Dados</span>
                                </button>
                                
                                <button type="button" class="btn btn-success btn-lg" id="btnPreencherPlanilha">
                                    <i class="fas fa-arrow-down me-2"></i>
                                    <span>Preencher Planilha</span>
                                </button>
                                
                                <button type="button" class="btn btn-outline-secondary" id="btnLimparDados">
                                    <i class="fas fa-eraser me-2"></i>
                                    <span>Limpar Dados</span>
                                </button>
                            </div>
                            
                            <!-- Formato esperado -->
                            <div class="importacao-format">
                                <h6 class="importacao-format-title">
                                    <i class="fas fa-list me-2"></i>Formato Esperado
                                </h6>
                                <div class="importacao-format-content">
                                    <code>Título | Status | Tipo Execução | Tipo Teste | Componentes | Objetivo | Pré-condições | Descrição</code>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Preview dos dados processados -->
            <div id="previewContainer" class="importacao-preview" style="display: none;">
                <div class="importacao-preview-header">
                    <h6 class="importacao-preview-title">
                        <i class="fas fa-eye me-2"></i>Preview dos Dados Processados
                    </h6>
                    <span class="importacao-preview-count" id="previewCount">0 registros</span>
                </div>
                <div class="preview-table" id="previewTable"></div>
            </div>
        </div>
    </div>
</div>

<!-- Planilha Container -->
<div class="card shadow mb-4" id="planilhaSection" style="display: none;">
    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
        <h6 class="m-0 font-weight-bold text-primary">
            <i class="fas fa-table fa-fw me-2"></i>Planilha de Casos de Teste
        </h6>
        <div class="btn-group" role="group">
            <button type="button" class="btn btn-success btn-sm" id="btnAddRow">
                <i class="fas fa-plus me-1"></i>Adicionar Linha
            </button>
            <button type="button" class="btn btn-primary btn-sm" id="btnExportJira">
                <i class="fas fa-upload me-1"></i>Exportar para Jira
            </button>
        </div>
    </div>
    <div class="card-body p-0">
        <!-- Indicadores de status -->
        <div class="d-flex justify-content-between align-items-center p-3 bg-light border-bottom">
            <div class="d-flex align-items-center">
                <span class="badge badge-info me-2">
                    <i class="fas fa-info-circle me-1"></i>Dica: Use Ctrl+Enter para adicionar linha
                </span>
                <span class="badge badge-secondary me-2">
                    <i class="fas fa-keyboard me-1"></i>Ctrl+S para exportar
                </span>
                <span class="badge badge-warning">
                    <i class="fas fa-mobile-alt me-1"></i>Responsivo
                </span>
            </div>
            <div class="text-muted small">
                <i class="fas fa-clock me-1"></i>
                <span id="lastUpdate">Última atualização: Agora</span>
            </div>
        </div>
        
        <div class="table-responsive" style="max-height: 70vh; overflow-y: auto;">
            <table class="table table-hover mb-0" id="planilhaTable">
                <thead class="thead-light">
                    <tr>
                        <th style="width: 80px;">Ações</th>
                        <th style="width: 100px;">ID</th>
                        <th style="width: 200px;">Título</th>
                        <th style="width: 120px;">Status</th>
                        <th style="width: 140px;">Tipo de Execução</th>
                        <th style="width: 120px;">Tipo de Teste</th>
                        <th style="width: 150px;">Componentes</th>
                        <th style="width: 200px;">Objetivo</th>
                        <th style="width: 150px;">Pré-condições</th>
                        <th style="width: 200px;">Descrição</th>
                        <th style="width: 120px;">Criado em</th>
                        <th style="width: 120px;">Atualizado em</th>
                    </tr>
                </thead>
                <tbody id="planilhaBody">
                    <!-- Linhas serão adicionadas dinamicamente -->
                </tbody>
            </table>
        </div>
        
        <!-- Footer da planilha com estatísticas -->
        <div class="d-flex justify-content-between align-items-center p-3 bg-light border-top">
            <div class="text-muted small">
                <i class="fas fa-table me-1"></i>
                <span id="tableStats">0 linhas na planilha</span>
            </div>
            <div class="text-muted small">
                <i class="fas fa-save me-1"></i>
                <span id="saveStatus">Pronto para salvar</span>
            </div>
        </div>
    </div>
</div>

<!-- Instructions -->
<div class="card shadow mb-4" id="instructionsSection" style="display: none;">
    <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">
            <i class="fas fa-info-circle fa-fw me-2"></i>Instruções
        </h6>
    </div>
    <div class="card-body">
        <ol>
            <li><strong>Importação em Massa:</strong> Cole dados de uma tabela na seção superior para preencher automaticamente</li>
            <li><strong>Edição Manual:</strong> Preencha os dados diretamente na planilha ou adicione linhas individuais</li>
            <li><strong>Adicione linhas</strong> usando o botão "Adicionar Linha"</li>
            <li><strong>Remova linhas</strong> usando o botão "X" em cada linha</li>
            <li><strong>Exporte para Jira</strong> usando o botão "Exportar para Jira"</li>
            <li><strong>IDs e datas</strong> serão preenchidos automaticamente após a exportação</li>
        </ol>
    </div>
</div>

<!-- Modal para configuração de exportação -->
<div class="modal fade" id="exportModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-upload me-2"></i>Exportar para Jira
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group mb-3">
                    <label for="issuePai"><strong>Issue Pai (Requisito):</strong></label>
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text">
                                <i class="fas fa-clipboard-list"></i>
                            </span>
                        </div>
                        <input type="text" class="form-control" id="issuePai" 
                               placeholder="Digite o ID do requisito (ex: REQ-123)" 
                               required autocomplete="off" spellcheck="false">
                    </div>
                    <small class="form-text text-muted">
                        <i class="fas fa-info-circle me-1"></i>
                        ID da issue pai onde os casos de teste serão criados. 
                        <a href="#" onclick="mostrarAjudaIssuePai()" class="text-decoration-none">Como encontrar?</a>
                    </small>
                </div>
                <div class="alert alert-info">
                    <strong>Total de casos:</strong> <span id="totalCasos">0</span>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="btnConfirmExport">
                    <i class="fas fa-upload me-1"></i>Exportar
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<link href="{{ url_for('static', filename='css/planilha_manual_sb_admin.css') }}" rel="stylesheet">
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/planilha_manual.js') }}"></script>
{% endblock %}
